@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   Engram — Hearthside Design System
   "Like sitting by a fireplace — warm, safe, enveloping"

   Dark mode uses html.dark ancestor selectors for raw CSS
   and Tailwind dark: prefix in JSX components.
   ============================================ */

@layer base {
  /* Typography defaults */
  html {
    color: #1C1916;
  }
  html.dark {
    color: #F5EDE3;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: 'Fraunces', Georgia, serif;
    letter-spacing: -0.01em;
  }

  h1 { font-size: 2.75rem; line-height: 1.1; font-weight: 600; }
  h2 { font-size: 2rem; line-height: 1.15; font-weight: 600; }
  h3 { font-size: 1.5rem; line-height: 1.2; font-weight: 500; }
  h4 { font-size: 1.25rem; line-height: 1.3; font-weight: 500; }

  p {
    font-family: 'DM Sans', system-ui, sans-serif;
    line-height: 1.625;
  }

  /* Focus styles — warm amber ring */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px #FAF5EF, 0 0 0 4px rgba(232, 168, 76, 0.6);
    border-radius: 0.5rem;
  }
  html.dark :focus-visible {
    box-shadow: 0 0 0 2px #1C1916, 0 0 0 4px rgba(232, 168, 76, 0.4);
  }

  /* Selection color — honey amber */
  ::selection {
    background: #FDDB8C;
    color: #4A2E0D;
  }
  html.dark ::selection {
    background: #6E4512;
    color: #FFF8EB;
  }

  /* Warm scrollbar styling (webkit) */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb {
    background: rgba(180, 164, 142, 0.4);
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: rgba(180, 164, 142, 0.6);
  }
  html.dark ::-webkit-scrollbar-thumb {
    background: rgba(74, 61, 50, 0.5);
  }
  html.dark ::-webkit-scrollbar-thumb:hover {
    background: rgba(74, 61, 50, 0.7);
  }

  /* Firefox scrollbar */
  * { scrollbar-color: rgba(180, 164, 142, 0.4) transparent; scrollbar-width: thin; }
  html.dark * { scrollbar-color: rgba(74, 61, 50, 0.5) transparent; }

  /* Chrome autofill override */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px #FAF5EF inset;
    -webkit-text-fill-color: #3D3229;
    transition: background-color 5000s ease-in-out 0s;
  }
  html.dark input:-webkit-autofill,
  html.dark input:-webkit-autofill:hover,
  html.dark input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px #231D1B inset;
    -webkit-text-fill-color: #F5EDE3;
    transition: background-color 5000s ease-in-out 0s;
  }
}

@layer components {
  /* ============================================
     Buttons — Warm, tactile, inviting
     ============================================ */

  .btn {
    @apply inline-flex items-center justify-center gap-2
           font-body font-semibold rounded-2xl
           transition-all duration-200
           focus:outline-none;
  }

  .btn-primary {
    @apply btn px-6 py-3 shadow-soft
           hover:scale-[1.02] active:scale-[0.98];
    background: linear-gradient(135deg, #E8A84C, #D4922E);
    color: #1C1916;
  }
  .btn-primary:hover {
    box-shadow: 0 0 20px rgba(232, 168, 76, 0.3);
  }
  html.dark .btn-primary {
    background: linear-gradient(135deg, #E8A84C, #D4922E);
    color: #1C1916;
  }
  html.dark .btn-primary:hover {
    box-shadow: 0 0 20px rgba(232, 168, 76, 0.4);
  }

  .btn-secondary {
    @apply btn px-6 py-3 backdrop-blur-sm active:scale-[0.98];
    background: rgba(232, 221, 208, 0.6);
    color: #4A3D32;
    border: 1px solid rgba(212, 196, 176, 0.5);
  }
  .btn-secondary:hover {
    background: rgba(232, 221, 208, 0.85);
    border-color: rgba(212, 196, 176, 0.7);
  }
  html.dark .btn-secondary {
    background: rgba(74, 61, 50, 0.3);
    color: #F5EDE3;
    border: 1px solid rgba(74, 61, 50, 0.4);
  }
  html.dark .btn-secondary:hover {
    background: rgba(74, 61, 50, 0.5);
    border-color: rgba(74, 61, 50, 0.6);
  }

  .btn-ghost {
    @apply btn px-4 py-2 rounded-xl;
    color: #6B5A4A;
  }
  .btn-ghost:hover {
    color: #2A2420;
    background: rgba(232, 221, 208, 0.5);
  }
  html.dark .btn-ghost {
    color: #B8A48E;
  }
  html.dark .btn-ghost:hover {
    color: #F5EDE3;
    background: rgba(74, 61, 50, 0.3);
  }

  .btn-danger {
    @apply btn px-6 py-3 shadow-soft text-white
           hover:scale-[1.02] active:scale-[0.98];
    background: linear-gradient(135deg, #C4725A, #9E5040);
  }

  .btn-success {
    @apply btn px-6 py-3 shadow-soft text-white
           hover:scale-[1.02] active:scale-[0.98];
    background: linear-gradient(135deg, #7A9E7E, #5A7E5E);
  }
  .btn-success:hover {
    box-shadow: 0 0 20px rgba(122, 158, 126, 0.3);
  }
  html.dark .btn-success {
    background: linear-gradient(135deg, rgba(122, 158, 126, 0.9), rgba(90, 126, 94, 0.9));
  }
  html.dark .btn-success:hover {
    box-shadow: 0 0 20px rgba(122, 158, 126, 0.4);
  }

  /* ============================================
     Cards — Journal-page feel
     ============================================ */

  .card {
    @apply backdrop-blur-sm rounded-3xl p-6 shadow-soft
           transition-all duration-300;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(232, 221, 208, 0.6);
  }
  html.dark .card {
    background: rgba(35, 29, 27, 0.95);
    border: 1px solid rgba(74, 61, 50, 0.4);
  }

  .card-interactive {
    @apply card cursor-pointer active:scale-[0.99];
  }
  .card-interactive:hover {
    @apply shadow-soft-lg;
    transform: translateY(-2px);
  }
  html.dark .card-interactive {
    background: rgba(35, 29, 27, 0.95);
    border: 1px solid rgba(74, 61, 50, 0.4);
  }
  html.dark .card-interactive:hover {
    border-color: rgba(74, 61, 50, 0.6);
  }

  .card-glass {
    @apply backdrop-blur-md rounded-3xl p-6 shadow-soft;
    background: rgba(250, 245, 239, 0.3);
    border: 1px solid rgba(232, 221, 208, 0.3);
  }
  html.dark .card-glass {
    background: rgba(28, 25, 22, 0.3);
    border: 1px solid rgba(74, 61, 50, 0.2);
  }

  /* Warm accent card — for prompts, nudges */
  .card-warm {
    @apply card relative overflow-hidden;
    background: linear-gradient(135deg, rgba(255, 248, 235, 0.8), rgba(253, 242, 239, 0.4));
  }
  html.dark .card-warm {
    background: linear-gradient(135deg, rgba(74, 69, 18, 0.15), rgba(94, 45, 36, 0.1));
    border: 1px solid rgba(74, 61, 50, 0.3);
  }

  /* Elevated card — hover lift effect */
  .card-elevated {
    @apply card cursor-pointer;
    transition: all 0.3s ease;
  }
  .card-elevated:hover {
    @apply shadow-soft-lg;
    transform: translateY(-2px);
  }
  html.dark .card-elevated {
    background: rgba(35, 29, 27, 0.95);
    border: 1px solid rgba(74, 61, 50, 0.4);
  }
  html.dark .card-elevated:hover {
    border-color: rgba(74, 61, 50, 0.6);
  }

  /* Featured card — gradient accent background */
  .card-featured {
    @apply backdrop-blur-sm rounded-3xl p-6 shadow-soft
           transition-all duration-300;
    background: linear-gradient(135deg, rgba(252, 196, 79, 0.2), rgba(196, 114, 90, 0.15));
    border: 1px solid rgba(232, 221, 208, 0.6);
  }
  html.dark .card-featured {
    background: linear-gradient(135deg, rgba(110, 69, 18, 0.25), rgba(94, 45, 36, 0.2));
    border: 1px solid rgba(74, 61, 50, 0.4);
  }

  /* ============================================
     Modals — Warm overlays
     ============================================ */

  .modal-backdrop {
    @apply fixed inset-0 z-50 backdrop-blur-md animate-fade-in;
    background: linear-gradient(135deg, rgba(28, 25, 22, 0.8), rgba(42, 36, 32, 0.85));
  }

  .modal-content {
    @apply rounded-3xl shadow-soft-xl max-w-md w-full mx-4 animate-scale-in;
    background: #FAF5EF;
  }
  html.dark .modal-content {
    background: #231D1B;
    border: 1px solid rgba(74, 61, 50, 0.3);
  }

  /* ============================================
     Inputs — Warm and inviting
     ============================================ */

  .input {
    @apply w-full px-4 py-3 rounded-2xl font-body
           transition-all duration-200 focus:outline-none;
    background: rgba(245, 237, 227, 0.8);
    border: 2px solid rgba(232, 221, 208, 0.8);
    color: #2A2420;
  }
  .input::placeholder { color: #B8A48E; }
  .input:focus {
    border-color: rgba(232, 168, 76, 0.6);
    background: white;
    box-shadow: 0 2px 15px -3px rgba(42, 36, 32, 0.08);
  }
  html.dark .input {
    background: rgba(28, 25, 22, 0.6);
    border: 2px solid rgba(74, 61, 50, 0.5);
    color: #F5EDE3;
  }
  html.dark .input::placeholder { color: #8E7A66; }
  html.dark .input:focus {
    border-color: rgba(232, 168, 76, 0.5);
    background: rgba(42, 36, 32, 0.8);
    box-shadow: 0 2px 15px -3px rgba(0, 0, 0, 0.2);
  }

  .input-lg {
    @apply input px-5 py-4 text-lg rounded-2xl;
  }

  .textarea {
    @apply input min-h-[120px] resize-none;
  }

  /* ============================================
     Badges — Soft pill shapes
     ============================================ */

  .badge {
    @apply inline-flex items-center gap-1
           px-3 py-1 rounded-full
           text-xs font-semibold font-body;
  }

  .badge-primary   { @apply badge bg-sage-100 text-sage-700; }
  .badge-secondary { @apply badge bg-lavender-100 text-lavender-700; }
  .badge-accent    { @apply badge bg-honey-100 text-honey-700; }
  .badge-terra     { @apply badge bg-terra-100 text-terra-700; }

  html.dark .badge-primary   { background: rgba(26, 36, 27, 0.3); color: #9DC0A3; }
  html.dark .badge-secondary { background: rgba(34, 30, 48, 0.3); color: #B5A7D4; }
  html.dark .badge-accent    { background: rgba(74, 46, 13, 0.3); color: #FCC44F; }
  html.dark .badge-terra     { background: rgba(63, 30, 24, 0.3); color: #D4917E; }

  .badge-mood-great { @apply badge bg-sage-100 text-sage-700; }
  .badge-mood-low   { @apply badge bg-lavender-100 text-lavender-700; }

  html.dark .badge-mood-great { background: rgba(26, 36, 27, 0.3); color: #9DC0A3; }
  html.dark .badge-mood-low   { background: rgba(34, 30, 48, 0.3); color: #B5A7D4; }

  /* ============================================
     Mood Indicators
     ============================================ */

  .mood-bar {
    @apply h-1.5 rounded-full transition-all duration-500;
  }

  .mood-great      { @apply bg-sage-400; }
  .mood-good       { @apply bg-sage-300; }
  .mood-neutral    { @apply bg-honey-400; }
  .mood-low        { @apply bg-lavender-400; }
  .mood-struggling { @apply bg-terra-400; }

  .mood-dot {
    @apply w-2.5 h-2.5 rounded-full transition-colors duration-300;
  }

  /* ============================================
     Loading States
     ============================================ */

  .breathing-loader {
    @apply w-16 h-16 rounded-full animate-breathe shadow-glow;
    background: linear-gradient(135deg, #FCC44F, #C4725A);
  }

  .shimmer {
    @apply bg-gradient-to-r from-hearth-200 via-hearth-100 to-hearth-200
           bg-[length:200%_100%] animate-shimmer;
  }
  html.dark .shimmer {
    @apply bg-gradient-to-r from-hearth-800 via-hearth-700 to-hearth-800;
  }

  /* ============================================
     Effects
     ============================================ */

  .celebration-glow { @apply animate-glow; }
  .floating { @apply animate-float; }

  /* Paper grain texture overlay */
  .grain {
    position: relative;
  }
  .grain::after {
    content: '';
    position: absolute;
    inset: 0;
    opacity: 0.03;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  /* ============================================
     Safe Area Insets
     ============================================ */

  .safe-top    { padding-top: env(safe-area-inset-top); }
  .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
  .safe-left   { padding-left: env(safe-area-inset-left); }
  .safe-right  { padding-right: env(safe-area-inset-right); }

  /* ============================================
     Entry Card — Journal page accent
     ============================================ */

  .entry-card {
    @apply card relative overflow-hidden;
  }
  html.dark .entry-card {
    background: rgba(35, 29, 27, 0.95);
    border: 1px solid rgba(74, 61, 50, 0.4);
  }

  .entry-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    border-radius: 1.5rem 0 0 1.5rem;
    background: linear-gradient(to bottom, #E8A84C, #C4725A);
  }

  .entry-card-great::before {
    background: linear-gradient(to bottom, #7A9E7E, #5A7E5E);
  }
  .entry-card-good::before {
    background: linear-gradient(to bottom, #9DC0A3, #7A9E7E);
  }
  .entry-card-neutral::before {
    background: linear-gradient(to bottom, #E8A84C, #D4922E);
  }
  .entry-card-low::before {
    background: linear-gradient(to bottom, #9B8EC4, #7B6EA4);
  }
  .entry-card-struggling::before {
    background: linear-gradient(to bottom, #C4725A, #9E5040);
  }

  /* ============================================
     Recording Animation
     ============================================ */

  .recording-ring {
    @apply absolute inset-0 rounded-full animate-ping opacity-75;
    border: 4px solid #C4725A;
  }

  .recording-pulse {
    @apply w-20 h-20 rounded-full shadow-lg animate-pulse-soft;
    background: linear-gradient(135deg, #C4725A, #9E5040);
  }

  /* ============================================
     Prompt Card — Handwritten feel
     ============================================ */

  .prompt-card {
    @apply card-warm relative;
  }
  html.dark .prompt-card {
    background: linear-gradient(135deg, rgba(74, 69, 18, 0.15), rgba(94, 45, 36, 0.1));
    border: 1px solid rgba(74, 61, 50, 0.3);
  }
  .prompt-card::before {
    content: '';
    position: absolute;
    left: 1rem; top: 1rem; bottom: 1rem;
    width: 2px;
    border-radius: 9999px;
    background: linear-gradient(to bottom, #E8A84C, transparent);
  }
}

@layer utilities {
  /* Text gradient — warm amber to terra */
  .text-gradient {
    @apply bg-gradient-to-r from-honey-500 to-terra-500
           bg-clip-text text-transparent;
  }

  .text-gradient-sage {
    @apply bg-gradient-to-r from-sage-500 to-sage-400
           bg-clip-text text-transparent;
  }

  /* Gradient presets — light/dark auto-switching */
  .gradient-hearth-glow {
    background: linear-gradient(135deg, #FCC44F, #C4725A);
  }
  html.dark .gradient-hearth-glow {
    background: linear-gradient(135deg, rgba(110, 69, 18, 0.6), rgba(94, 45, 36, 0.6));
  }

  .gradient-sage-mist {
    background: linear-gradient(135deg, #E0ECE2, #9DC0A3);
  }
  html.dark .gradient-sage-mist {
    background: linear-gradient(135deg, rgba(26, 36, 27, 0.4), rgba(37, 53, 39, 0.4));
  }

  .gradient-lavender-dusk {
    background: linear-gradient(135deg, #E8E3F2, #B5A7D4);
  }
  html.dark .gradient-lavender-dusk {
    background: linear-gradient(135deg, rgba(34, 30, 48, 0.4), rgba(53, 47, 73, 0.4));
  }

  .gradient-terra-dawn {
    background: linear-gradient(135deg, #FADDD5, #FEECC8);
  }
  html.dark .gradient-terra-dawn {
    background: linear-gradient(135deg, rgba(63, 30, 24, 0.4), rgba(74, 46, 13, 0.4));
  }

  .gradient-hearth-surface {
    background: linear-gradient(135deg, #FAF5EF, #FFFFFF);
  }
  html.dark .gradient-hearth-surface {
    background: linear-gradient(135deg, #1C1916, #231D1B);
  }

  /* Glass effect */
  .glass {
    background: rgba(250, 245, 239, 0.2);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(232, 221, 208, 0.2);
  }

  .inset-soft { @apply shadow-inner-soft; }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar { display: none; }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .tap-transparent {
    -webkit-tap-highlight-color: transparent;
  }

  .text-hand { font-family: 'Caveat', cursive; }
}

/* ============================================
   Action Item Animations (outside @layer)
   ============================================ */

@keyframes strikethrough {
  0%   { width: 0; }
  100% { width: 100%; }
}

@keyframes fadeOutSlide {
  0%   { opacity: 1; transform: translateX(0); max-height: 60px; }
  70%  { opacity: 0; transform: translateX(20px); max-height: 60px; }
  100% { opacity: 0; transform: translateX(20px); max-height: 0; padding: 0; margin: 0; }
}

.action-item-completing {
  animation: fadeOutSlide 0.6s ease-out forwards;
  animation-delay: 0.4s;
}

.action-item-completing .strikethrough-line {
  position: absolute;
  left: 0; top: 50%;
  height: 2px;
  background-color: #D4922E;
  animation: strikethrough 0.3s ease-out forwards;
}

.action-checkbox {
  width: 1.25rem; height: 1.25rem;
  border-radius: 9999px;
  border: 2px solid #D4C4B0;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}
.action-checkbox:hover {
  border-color: #E8A84C;
  background: #FFF8EB;
}
.action-checkbox.checked {
  border-color: #5A7E5E;
  background: #5A7E5E;
}
html.dark .action-checkbox {
  border-color: #4A3D32;
}
html.dark .action-checkbox:hover {
  border-color: #E8A84C;
  background: #2A2420;
}
html.dark .action-checkbox.checked {
  border-color: #5A7E5E;
  background: #5A7E5E;
}

.badge-recurring {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  background: #E8E3F2;
  color: #635887;
}
html.dark .badge-recurring {
  background: rgba(34, 30, 48, 0.3);
  color: #B5A7D4;
}
